<div class="card-container forecast-card">
    <div class="card-header">
        <h3 class="card-title">Hourly Forecast</h3>
        <button class="btn-toggle" (click)="toggleView()">
            {{ isGraphView ? 'ðŸ“Š Card View' : 'ðŸ“ˆ Graph View' }}
        </button>
    </div>

    @if (isGraphView) {
    <div class="hourly-graph">
        <svg class="hourly-graph-svg" viewBox="0 0 1200 400" preserveAspectRatio="xMidYMid meet">

            @for (i of [0, 1, 2, 3, 4, 5]; track $index) {
                <line
                [attr.x1]="0"
                [attr.y1]="50 + i * 50"
                [attr.x2]="1200"
                [attr.y2]="50 + i * 50"
                class="grid-line">
                </line>
            }

            <defs>
                <linearGradient id="hourlyGradient" x1="0" y1="0" x2="0" y2="100%">
                    <stop offset="0%" style="stop-color:var(--accent-color);stop-opacity:0.4"></stop>
                    <stop offset="100%" style="stop-color:var(--accent-color);stop-opacity:0.05"></stop>
                </linearGradient>
            </defs>

            <polygon [attr.points]="getHourlyGraphPolygonPoints()"
                    fill="url(#hourlyGradient)"></polygon>

            <polyline [attr.points]="getHourlyGraphPoints()" class="temp-curve" fill="none"></polyline>

            @for (point of getHourlyDataPoints(); track $index; let i = $index) {
                <g>
                    <circle [attr.cx]="getHourlyXPosition(i)"
                            [attr.cy]="getHourlyYPosition(point.value)" r="6"
                            class="data-point"></circle>

                    <text [attr.x]="getHourlyXPosition(i)"
                          [attr.y]="getHourlyYPosition(point.value) - 10"
                          class="temp-label">
                          {{ formatGraphLabel(point.value) }}
                    </text>

                    @if (selectedDataType === 'temp' && point.icon) {
                        <image [attr.x]="getHourlyXPosition(i) - 20"
                               [attr.y]="340" width="40" height="40"
                               [attr.href]="'http://openweathermap.org/img/w/' + point.icon + '.png'"></image>
                    }

                    <text [attr.x]="getHourlyXPosition(i)"
                          [attr.y]="390"
                          class="time-label">
                          {{ point.time | date: 'HH:mm' }}
                    </text>
                </g>
            }
        </svg>
    </div>
    }

    @if (!isGraphView) {
    <div class="hourly-grid mt-4">
        @for (hour of hourlyForecast; track $index) {
            <div class="hourly-item text-center">
                <p class="hourly-time">{{ hour.dt * 1000 | date: 'HH:mm' }}</p>
                <img [src]="'http://openweathermap.org/img/w/' + hour.weather[0].icon + '.png'">
                <p class="hourly-temp">{{ hour.main.temp | number:'1.0-0' }}Â°C</p>
                <p class="hourly-wind">{{ hour.wind.speed | number:'1.0-0' }} km/h</p>
            </div>
        }
    </div>
    }
</div>
